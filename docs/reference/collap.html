<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Advanced Data Aggregation — collap • collapse</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Advanced Data Aggregation — collap" />
<meta property="og:description" content="collap is a fast and easy to use multi-purpose data aggregation command.
It performs simple aggregations, multi-type data aggregations applying different functions to numeric and categorical data, weighted aggregations (including weighted multi-type aggregations), aggregations applying multiple functions to each column (which can be performed in parallel), and fully customized aggregations where the user passes a list mapping functions to columns.
collap works with collapse's Fast Statistical Functions, providing extremely fast conventional and weighted aggregation. It also works with other functions but this does not deliver high speeds on large data and does not support weighted aggregations.
" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../blog/index.html">Blog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/collapse">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Advanced Data Aggregation</h1>
    
    <div class="hidden name"><code>collap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>collap</code> is a fast and easy to use multi-purpose data aggregation command.</p>
<p>It performs simple aggregations, multi-type data aggregations applying different functions to numeric and categorical data, weighted aggregations (including weighted multi-type aggregations), aggregations applying multiple functions to each column (which can be performed in parallel), and fully customized aggregations where the user passes a list mapping functions to columns.</p>
<p><code>collap</code> works with <em>collapse</em>'s <a href='fast-statistical-functions.html'>Fast Statistical Functions</a>, providing extremely fast conventional and weighted aggregation. It also works with other functions but this does not deliver high speeds on large data and does not support weighted aggregations.</p>
<p><!-- % \code{collap} supports formula and data (i.e. grouping vectors or lists of vectors) input to \code{by}, whereas \code{collapv} allows names and indices of grouping columns to be passed to \code{by}. --></p>
    </div>

    <pre class="usage"><span class='co'># Main function: allows formula and data input to `by` and `w` arguments</span>
<span class='fu'>collap</span>(<span class='no'>X</span>, <span class='no'>by</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>fmean</span>, <span class='kw'>catFUN</span> <span class='kw'>=</span> <span class='no'>fmode</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>wFUN</span> <span class='kw'>=</span> <span class='no'>fsum</span>,
       <span class='kw'>custom</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>keep.by</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>keep.w</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
       <span class='kw'>sort.row</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>,
       <span class='kw'>return</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"wide"</span>,<span class='st'>"list"</span>,<span class='st'>"long"</span>,<span class='st'>"long_dupl"</span>), <span class='kw'>give.names</span> <span class='kw'>=</span> <span class='st'>"auto"</span>, <span class='no'>...</span>)

<span class='co'># Programmer function: allows column names and indices input to `by` and `w` arguments</span>
<span class='fu'>collapv</span>(<span class='no'>X</span>, <span class='no'>by</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>fmean</span>, <span class='kw'>catFUN</span> <span class='kw'>=</span> <span class='no'>fmode</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>wFUN</span> <span class='kw'>=</span> <span class='no'>fsum</span>,
        <span class='kw'>custom</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>keep.by</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>keep.w</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
        <span class='kw'>sort.row</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>,
        <span class='kw'>return</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"wide"</span>,<span class='st'>"list"</span>,<span class='st'>"long"</span>,<span class='st'>"long_dupl"</span>), <span class='kw'>give.names</span> <span class='kw'>=</span> <span class='st'>"auto"</span>, <span class='no'>...</span>)

<span class='co'># Auxiliary function: for grouped tibble ('grouped_df') input + non-standard evaluation</span>
<span class='fu'>collapg</span>(<span class='no'>X</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>fmean</span>, <span class='kw'>catFUN</span> <span class='kw'>=</span> <span class='no'>fmode</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>wFUN</span> <span class='kw'>=</span> <span class='no'>fsum</span>, <span class='kw'>custom</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
        <span class='kw'>keep.group_vars</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>keep.w</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>sort.row</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
        <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>,
        <span class='kw'>return</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"wide"</span>,<span class='st'>"list"</span>,<span class='st'>"long"</span>,<span class='st'>"long_dupl"</span>), <span class='kw'>give.names</span> <span class='kw'>=</span> <span class='st'>"auto"</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>a data.frame, or an object coercible to data.frame using <code><a href='quick-conversion.html'>qDF</a></code>.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>for <code>collap</code>: a one-or two sided formula, i.e. <code>~ group1</code> or <code>var1 + var2 ~ group1 + group2</code>, or a atomic vector, list of vectors or <code><a href='GRP.html'>GRP</a></code> object used to group <code>X</code>. For <code>collapv</code>: names or indices of grouping columns, or a logical vector or selector function such as <code><a href='small-helper.html'>is.categorical</a></code> selecting grouping columns.</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>a function, list of functions (i.e. <code><a href='https://rdrr.io/r/base/list.html'>list(fsum, fmean, fsd)</a></code> or <code><a href='https://rdrr.io/r/base/list.html'>list(myfun1 = function(x).., sd = sd)</a></code>), or a character vector of function names, which are automatically applied only to numeric variables.</p></td>
    </tr>
    <tr>
      <th>catFUN</th>
      <td><p>same as <code>FUN</code>, but applied only to categorical (non-numeric) typed columns (<code><a href='small-helper.html'>is.categorical</a></code>).</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>select columns to aggregate using a function, column names, indices or logical vector. <em>Note</em>: <code>cols</code> is ignored if a two-sided formula is passed to <code>by</code>.</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>weights. Can be passed as numeric vector or alternatively as formula i.e. <code>~ weightvar</code> in <code>collap</code> or column name / index etc. i.e. <code>"weightvar"</code> in <code>collapv</code>. <code>collapg</code> supports non-standard evaluations so <code>weightvar</code> can be indicate without quotes if found in <code>X</code>.</p></td>
    </tr>
    <tr>
      <th>wFUN</th>
      <td><p>same as <code>FUN</code>: Function(s) to aggregate weight variable if <code>keep.w = TRUE</code>. By default the sum of the weights is computed in each group.</p></td>
    </tr>
    <tr>
      <th>custom</th>
      <td><p>a named list specifying a fully customized aggregation task. The names of the list are function names and the content columns to aggregate using this function (same input as <code>cols</code>). For example <code>custom = list(fmean = 1:6, fsd = 7:9, fmode = 10:11)</code> tells <code>collap</code> to aggregate columns 1-6 of <code>X</code> using the mean, columns 7-9 using the standard deviation etc. <em>Note</em>: <code>custom</code> lets <code>collap</code> ignore any inputs passed to <code>FUN</code>, <code>catFUN</code> or <code>cols</code>.</p></td>
    </tr>
    <tr>
      <th>keep.by, keep.group_vars</th>
      <td><p>logical. <code>FALSE</code> will omit grouping variables from the output. <code>TRUE</code> keeps the variables, even if passed externally in a list or vector (unlike other <em>collapse</em> functions).</p></td>
    </tr>
    <tr>
      <th>keep.w</th>
      <td><p>logical. <code>FALSE</code> will omit weight variable from the output i.e. no aggregation of the weights. <code>TRUE</code> aggregates and adds weights, even if passed externally as a vector (unlike other <em>collapse</em> functions).</p></td>
    </tr>
    <tr>
      <th>keep.col.order</th>
      <td><p>logical. Retain original column order post-aggregation.</p></td>
    </tr>
    <tr>
      <th>sort.row</th>
      <td><p>logical. Sort rows by the groups. From <em>collapse 1.2.0</em> this only applies to character grouping variables.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>logical. Use <code><a href='https://rdrr.io/r/parallel/mcdummies.html'>parallel::mclapply</a></code> instead of <code>lapply</code> for multi-function or custom aggregation.</p></td>
    </tr>
    <tr>
      <th>mc.cores</th>
      <td><p>integer. Argument to <code><a href='https://rdrr.io/r/parallel/mcdummies.html'>parallel::mclapply</a></code> setting the number of cores to use.</p></td>
    </tr>
    <tr>
      <th>return</th>
      <td><p>character. Control the output format when aggregating with multiple functions or performing custom aggregation. "wide" (default) returns a wider data frame with added columns for each additional function. "list" returns a list of data frame's - one for each function. "long" adds a column "Function" and row-binds the results from different functions using <code><a href='https://rdrr.io/pkg/data.table/man/rbindlist.html'>data.table::rbindlist</a></code>. "long.dupl" is a special option for aggregating multi-type data using multiple <code>FUN</code> but only one <code>catFUN</code> or vice-versa. In that case the format is long and data aggregated using only one function is duplicated. See Examples.</p></td>
    </tr>
    <tr>
      <th>give.names</th>
      <td><p>logical. Create unique names of aggregated columns by adding a prefix 'FUN.'. 'auto' will automatically create such prefixes whenever multiple functions are applied to a column or <code>custom</code> is used.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to all functions supplied to <code>FUN</code>, <code>catFUN</code>, <code>wFUN</code> or <code>custom</code>. The behavior of <a href='fast-statistical-functions.html'>Fast Statistical Functions</a> is regulated by <code><a href='https://rdrr.io/r/base/options.html'>option("collapse_unused_arg_action")</a></code> and defaults to <code>"warning"</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>collap</code> automatically checks each function passed to it whether it is a <a href='fast-statistical-functions.html'>Fast Statistical Function</a> (i.e. whether the function name is contained in <code>.FAST_STAT_FUN</code>). If the function is a fast function, <code>collap</code> only does the grouping and then calls the function to carry out the grouped computations. If the function is not one of <code>.FAST_STAT_FUN</code>, <code><a href='BY.html'>BY</a></code> is called internally to perform the computation. The resulting computations from each function are put into a list and recombined to produce the desired output format as controlled by the <code>return</code> argument. When multiple functions are used with <code>collap</code>, setting <code>parallel = TRUE</code> and the number of cores with <code>mc.cores</code> will instruct <code>collap</code> to execute these function calls in parallel using <code><a href='https://rdrr.io/r/parallel/mcdummies.html'>parallel::mclapply</a></code>. If only a single function is used which is not a <code>.FAST_STAT_FUN</code>, the <code>parallel</code> and <code>mc.cores</code> arguments are handed down to <code><a href='BY.html'>BY</a></code>. See Examples.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>X</code> aggregated by groups supplied to the <code>by</code> argument.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Since <code><a href='BY.html'>BY</a></code> does not check and split additional arguments passed to it, it is presently not possible to create a weighted function in R and apply it to data by groups with <code>collap</code>. Weighted aggregations only work with <a href='fast-statistical-functions.html'>Fast Statistical Functions</a> supporting weights. User written weighted functions can be applied using the <em>data.table</em> package.</p>
<p><code>collap</code> by default (<code>keep.by = TRUE, keep.w = TRUE</code>) preserves all arguments passed to the <code>by</code> or <code>w</code> arguments, whether passed in a formula or externally. The names of externally passed vectors and lists are intelligently extracted. So it is possible to write <code>collap(iris, iris$Species)</code>, and obtain an aggregated data frame with two <code>Species</code> columns, whereas <code>collap(iris, ~ Species)</code> only has one <code>Species</code> column. Similarly for weight vectors passed to <code>w</code>. In this regard <code>collap</code> is more sophisticated than other <em>collapse</em> functions where preservation of grouping and weight variables is restricted to formula use. For example <code><a href='fscale.html'>STD(iris, iris$Species)</a></code> does not preserve <code>Species</code> in the output, whereas <code><a href='fscale.html'>STD(iris, ~ Species)</a></code> does. This <code>collap</code> feature is there simply for convenience, for example sometimes a survey is disaggregated into several datasets, and this now allows easy pulling of identifiers or weights from other datasets for aggregations. If all information is available in one dataset, just using formulas is highly recommended.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='BY.html'>BY</a></code>, <a href='fast-statistical-functions.html'>Fast Statistical Functions</a>, <a href='collapse-documentation.html'>Collapse Overview</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'>## A Simple Introduction --------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>iris</span>)
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>)                                        <span class='co'># Default: FUN = fmean for numeric</span>
<span class='fu'>collapv</span>(<span class='no'>iris</span>, <span class='fl'>5</span>)                                               <span class='co'># Same using collapv</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>, <span class='no'>fmedian</span>)                               <span class='co'># Using the median</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>, <span class='no'>fmedian</span>, <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)       <span class='co'># Groups in-front</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, <span class='no'>Sepal.Width</span> + <span class='no'>Petal.Width</span> ~ <span class='no'>Species</span>, <span class='no'>fmedian</span>)     <span class='co'># Only '.Width' columns</span>
<span class='fu'>collapv</span>(<span class='no'>iris</span>, <span class='fl'>5</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>, <span class='fl'>4</span>))                               <span class='co'># Same using collapv</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fmedian</span>))                  <span class='co'># Two functions</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fmedian</span>), <span class='kw'>return</span> <span class='kw'>=</span> <span class='st'>"long"</span>) <span class='co'># Long format</span>
<span class='fu'>collapv</span>(<span class='no'>iris</span>, <span class='fl'>5</span>, <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>2</span>, <span class='kw'>fmedian</span> <span class='kw'>=</span> <span class='fl'>3</span>:<span class='fl'>4</span>))    <span class='co'># Custom aggregation</span>
<span class='fu'>collapv</span>(<span class='no'>iris</span>, <span class='fl'>5</span>, <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>2</span>, <span class='kw'>fmedian</span> <span class='kw'>=</span> <span class='fl'>3</span>:<span class='fl'>4</span>),    <span class='co'># Raw output, no column reordering</span>
        <span class='kw'>return</span> <span class='kw'>=</span> <span class='st'>"list"</span>)
<span class='fu'>collapv</span>(<span class='no'>iris</span>, <span class='fl'>5</span>, <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>2</span>, <span class='kw'>fmedian</span> <span class='kw'>=</span> <span class='fl'>3</span>:<span class='fl'>4</span>),    <span class='co'># A strange choice...</span>
        <span class='kw'>return</span> <span class='kw'>=</span> <span class='st'>"long"</span>)
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>, <span class='kw'>w</span> <span class='kw'>=</span> ~ <span class='no'>Sepal.Length</span>)                    <span class='co'># Using Sepal.Length as weights, ..</span>
<span class='no'>weights</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fu'><a href='small-helper.html'>fnrow</a></span>(<span class='no'>iris</span>)))
<span class='fu'>collap</span>(<span class='no'>iris</span>, ~ <span class='no'>Species</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>weights</span>)                           <span class='co'># Some random weights..</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, <span class='no'>iris</span>$<span class='no'>Species</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>weights</span>)                        <span class='co'># Note this behavior...</span>
<span class='fu'>collap</span>(<span class='no'>iris</span>, <span class='no'>iris</span>$<span class='no'>Species</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>weights</span>,
       <span class='kw'>keep.by</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>keep.w</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>) <span class='co'># Needed for "%&gt;%"</span>
<span class='no'>iris</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='GRP.html'>fgroup_by</a></span>(<span class='no'>Species</span>) <span class='kw'>%&gt;%</span> <span class='no'>collapg</span>                        <span class='co'># dplyr style, but faster</span>

<span class='co'>## Multi-Type Aggregation --------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>wlddev</span>)                                                    <span class='co'># World Development Panel Data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>))                        <span class='co'># Aggregate by country and decade</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='no'>fmedian</span>, <span class='no'>ffirst</span>))       <span class='co'># Different functions</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='no'>is.numeric</span>))     <span class='co'># Aggregate only numeric columns</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>))           <span class='co'># Only the 4 series</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, <span class='no'>PCGDP</span> + <span class='no'>LIFEEX</span> ~ <span class='no'>country</span> + <span class='no'>decade</span>))         <span class='co'># Only GDP and life-expactancy</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, <span class='no'>PCGDP</span> + <span class='no'>LIFEEX</span> ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='no'>fsum</span>))   <span class='co'># Using the sum instead</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, <span class='no'>PCGDP</span> + <span class='no'>LIFEEX</span> ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='no'>sum</span>,     <span class='co'># Same using base::sum -&gt; slower!!</span>
            <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, <span class='no'>wlddev</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"country"</span>,<span class='st'>"decade"</span>)], <span class='no'>fsum</span>,        <span class='co'># same, exploring different inputs</span>
            <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>10</span>))
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>[<span class='fl'>9</span>:<span class='fl'>10</span>], <span class='no'>wlddev</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"country"</span>,<span class='st'>"decade"</span>)], <span class='no'>fsum</span>))
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collapv</span>(<span class='no'>wlddev</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"country"</span>,<span class='st'>"decade"</span>), <span class='no'>fsum</span>))              <span class='co'># ... names/indices with collapv</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collapv</span>(<span class='no'>wlddev</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>5</span>), <span class='no'>fsum</span>))

<span class='no'>g</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='GRP.html'>GRP</a></span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>)                            <span class='co'># Precomputing the grouping</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, <span class='no'>g</span>, <span class='kw'>keep.by</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>))                        <span class='co'># This is slightly faster now</span>
<span class='co'># Aggregate categorical data using not the mode but the last element</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='no'>fmean</span>, <span class='no'>flast</span>))
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='kw'>catFUN</span> <span class='kw'>=</span> <span class='no'>flast</span>,         <span class='co'># Aggregate only categorical data</span>
            <span class='kw'>cols</span> <span class='kw'>=</span> <span class='no'>is.categorical</span>))


<span class='co'>## Weighted aggregation ----------------------------------------</span>
<span class='no'>weights</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fu'><a href='small-helper.html'>fnrow</a></span>(<span class='no'>wlddev</span>)))                            <span class='co'># Random weight vector</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>weights</span>))           <span class='co'># Takes weighted mean for numeric..</span>
<span class='co'># ..and weighted mode for categorical data. The weight vector is aggregated using fsum</span>
<span class='no'>wlddev</span>$<span class='no'>weights</span> <span class='kw'>&lt;-</span> <span class='no'>weights</span>                                       <span class='co'># Adding to data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='kw'>w</span> <span class='kw'>=</span> ~ <span class='no'>weights</span>))         <span class='co'># Keeps column order</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='kw'>w</span> <span class='kw'>=</span> ~ <span class='no'>weights</span>,          <span class='co'># Aggregating weights using sum</span>
            <span class='kw'>wFUN</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fsum</span>, <span class='no'>fmax</span>)))                           <span class='co'># and max (corresponding to mode)</span>
<span class='no'>wlddev</span>$<span class='no'>weights</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>


<span class='co'>## Multi-Function Aggregation ----------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fNobs</span>),     <span class='co'># Saving mean and Nobs</span>
            <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># same using base R -&gt; slower</span>
            <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>mean</span> <span class='kw'>=</span> <span class='no'>mean</span>,
                 <span class='kw'>Nobs</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>x</span>,<span class='no'>...</span>) <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>x</span>))),
            <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># list output format</span>
            <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fNobs</span>), <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>return</span> <span class='kw'>=</span> <span class='st'>"list"</span>))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># long output format</span>
            <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fNobs</span>), <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>return</span> <span class='kw'>=</span> <span class='st'>"long"</span>))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># also aggregating categorical data,</span>
            <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fNobs</span>), <span class='kw'>return</span> <span class='kw'>=</span> <span class='st'>"long_dupl"</span>))          <span class='co'># and duplicating it 2 times</span>

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># now also using 2 functions on</span>
            <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmean</span>, <span class='no'>fNobs</span>), <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fmode</span>, <span class='no'>flast</span>),             <span class='co'># categorical data</span>
            <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># more functions, string input,</span>
            <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"fmean"</span>,<span class='st'>"fsum"</span>,<span class='st'>"fNobs"</span>,<span class='st'>"fsd"</span>,<span class='st'>"fvar"</span>),             <span class='co'># parallelized execution</span>
            <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"fmode"</span>,<span class='st'>"ffirst"</span>,<span class='st'>"flast"</span>,<span class='st'>"fNdistinct"</span>),           <span class='co'># (choose more than 1 cores,</span>
            <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>,                     <span class='co'># depending on your machine)</span>
            <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>))


<span class='co'>## Custom Aggregation ------------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># custom aggregation</span>
            <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>fsd</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>10</span>, <span class='kw'>fmode</span> <span class='kw'>=</span> <span class='fl'>7</span>:<span class='fl'>8</span>)))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># using column names</span>
            <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='st'>"PCGDP"</span>, <span class='kw'>fsd</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"LIFEEX"</span>,<span class='st'>"GINI"</span>),
                          <span class='kw'>flast</span> <span class='kw'>=</span> <span class='st'>"date"</span>)))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># weighted parallelized custom</span>
            <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>fsd</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>10</span>,             <span class='co'># aggregation</span>
                          <span class='kw'>fmode</span> <span class='kw'>=</span> <span class='fl'>7</span>:<span class='fl'>8</span>), <span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>weights</span>,
            <span class='kw'>wFUN</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fsum</span>, <span class='no'>fmax</span>),
            <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>))

<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>collap</span>(<span class='no'>wlddev</span>, ~ <span class='no'>country</span> + <span class='no'>decade</span>,                         <span class='co'># No column reordering</span>
            <span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>fsd</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>10</span>,
                          <span class='kw'>fmode</span> <span class='kw'>=</span> <span class='fl'>7</span>:<span class='fl'>8</span>), <span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>weights</span>,
            <span class='kw'>wFUN</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>fsum</span>, <span class='no'>fmax</span>),
            <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>mc.cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>, <span class='kw'>keep.col.order</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>))


<span class='co'>## Piped use --------------------------------------------------</span>
<span class='no'>wlddev</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='GRP.html'>fgroup_by</a></span>(<span class='no'>country</span>, <span class='no'>decade</span>) <span class='kw'>%&gt;%</span> <span class='no'>collapg</span>
<span class='no'>wlddev</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='GRP.html'>fgroup_by</a></span>(<span class='no'>country</span>, <span class='no'>decade</span>) <span class='kw'>%&gt;%</span> <span class='fu'>collapg</span>(<span class='kw'>w</span> <span class='kw'>=</span> <span class='no'>ODA</span>)
<span class='no'>wlddev</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='GRP.html'>fgroup_by</a></span>(<span class='no'>country</span>, <span class='no'>decade</span>) <span class='kw'>%&gt;%</span> <span class='fu'>collapg</span>(<span class='no'>fmedian</span>, <span class='no'>flast</span>)
<span class='no'>wlddev</span> <span class='kw'>%&gt;%</span> <span class='fu'><a href='GRP.html'>fgroup_by</a></span>(<span class='no'>country</span>, <span class='no'>decade</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>collapg</span>(<span class='kw'>custom</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>fmean</span> <span class='kw'>=</span> <span class='fl'>9</span>:<span class='fl'>12</span>, <span class='kw'>fmode</span> <span class='kw'>=</span> <span class='fl'>5</span>:<span class='fl'>7</span>, <span class='kw'>flast</span> <span class='kw'>=</span> <span class='fl'>3</span>))</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


