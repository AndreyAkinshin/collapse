<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Recursive Row-Binding / Unlisting in 2D - to Data Frame — unlist2d • collapse</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Recursive Row-Binding / Unlisting in 2D - to Data Frame — unlist2d" />
<meta property="og:description" content="unlist2d efficiently unlists lists of regular R objects (objects built up from atomic elements) and creates a data frame representation of the list. It is a full 2-dimensional generalization of base::unlist, but is best understood and used as a recursive generalization of do.call(rbind, l), for lists of vectors, data frames, arrays or heterogeneous objects (i.e. unlisting happens via recursive flattening and intelligent row-binding of objects, see Details and Examples)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../blog/index.html">Blog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/collapse">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Recursive Row-Binding / Unlisting in 2D - to Data Frame</h1>
    
    <div class="hidden name"><code>unlist2d.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>unlist2d</code> efficiently unlists lists of regular R objects (objects built up from atomic elements) and creates a data frame representation of the list. It is a full 2-dimensional generalization of <code><a href='https://rdrr.io/r/base/unlist.html'>base::unlist</a></code>, but is best understood and used as a recursive generalization of <code><a href='https://rdrr.io/r/base/do.call.html'>do.call(rbind, l)</a></code>, for lists of vectors, data frames, arrays or heterogeneous objects (i.e. unlisting happens via recursive flattening and intelligent row-binding of objects, see Details and Examples).</p>
    </div>

    <pre class="usage"><span class='fu'>unlist2d</span>(<span class='no'>l</span>, <span class='kw'>idcols</span> <span class='kw'>=</span> <span class='st'>".id"</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>recursive</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
         <span class='kw'>id.factor</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>DT</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>l</th>
      <td><p>a unlistable list (with atomic elements in all final nodes, see <code><a href='is.unlistable.html'>is.unlistable</a></code>).</p></td>
    </tr>
    <tr>
      <th>idcols</th>
      <td><p>a character stub or a vector of names for id-columns automatically added - one for each level of nesting in <code>l</code>. By default the stub is <code>".id"</code>, so columns will be of the form <code>".id.1", ".id.2",</code> etc... . if <code>idcols = TRUE</code>, the stub is also set to <code>".id"</code>. If <code>idcols = FALSE</code>, id-columns are omitted. The content of the id columns are the list names, or (if missing) integers for the list elements. Missing elements in asymmetric nested structures are filled up with <code>NA</code>. See Examples.</p></td>
    </tr>
    <tr>
      <th>row.names</th>
      <td><p><code>TRUE</code> extracts row names from all the objects in <code>l</code> (where available) and adds them to the output in a column named <code>"row.names"</code>. Alternatively, a column name i.e. <code>row.names = "file"</code> can be supplied.</p></td>
    </tr>
    <tr>
      <th>recursive</th>
      <td><p>if <code>FALSE</code>, only process the lowest (deepest) level of <code>l</code>.</p></td>
    </tr>
    <tr>
      <th>id.factor</th>
      <td><p>if <code>TRUE</code> and <code>idcols != FALSE</code>, create id columns as ordered factors instead of character or integer vectors. This is useful if id's are used for further analysis e.g. as inputs to <code>ggplot2</code>.</p></td>
    </tr>
    <tr>
      <th>DT</th>
      <td><p>if <code>TRUE</code>, return a <em>data.table</em>, not a data frame.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The data frame representation created by <code>unlist2d</code> is built as follows:</p><ul>
<li><p>Recurse down to the lowest level of the list-tree, data frames are exempted and treated as a final elements.</p></li>
<li><p>Check out the objects, if they are vectors, matrices or arrays convert them to data frame (in the case of atomic vectors each element becomes a column).</p></li>
<li><p>Row-bind these data frame's using data.table's <code>rbindlist</code> function. Columns are matched by name. If the number of columns differ, fill empty spaces with NA's. If <code>idcols != FALSE</code>, create a id-columns on the left, filled with the object names or indices (if unnamed). If <code>row.names = TRUE</code>, store row-names of the objects (if available) in a separate column.</p></li>
<li><p>Move up to the next higher level of the list-tree and repeat: Convert atomic objects to data frame and row-bind while matching all columns and filling unmatched ones with NA's. Create another id-column for each level of nesting passed through. If the list-tree is asymmetric, fill empty spaces in lower-level id columns with NA's.</p></li>
</ul><p>The result of this iterative procedure is a single data frame containing on the left side id-columns for each level of nesting (from higher to lower level), followed by a column containing all the row.names of the objects if <code>row.names = TRUE</code>, followed by the object columns, matched at each level of recursion. Optimal results are of course obtained with symmetric lists of arrays, matrices or data frames, which <code>unlist2d</code> nicely converts to a beautiful data frame ready for plotting or further analysis. See examples below.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame or (if <code>DT = TRUE</code>) a <em>data.table</em>.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>For lists of data frames <code>unlist2d</code> works just like <code><a href='https://rdrr.io/pkg/data.table/man/rbindlist.html'>data.table::rbindlist(l, use.names = TRUE, fill = TRUE, idcol = ".id")</a></code> (also the same speed), however for lists of lists <code>unlist2d</code> does not produce the same output as <code><a href='https://rdrr.io/pkg/data.table/man/rbindlist.html'>data.table::rbindlist</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='rapply2d.html'>rapply2d</a></code>, <a href='list-processing.html'>List Processing</a>, <a href='collapse-documentation.html'>Collapse Overview</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'>## basic examples:</span>
<span class='no'>l</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>mtcars</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>mtcars</span>, <span class='no'>mtcars</span>))
<span class='fu'>unlist2d</span>(<span class='no'>l</span>)
<span class='fu'>unlist2d</span>(<span class='fu'><a href='rapply2d.html'>rapply2d</a></span>(<span class='no'>l</span>, <span class='no'>fmean</span>))
<span class='no'>l</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'><a href='quick-conversion.html'>qM</a></span>(<span class='no'>mtcars</span>[<span class='fl'>1</span>:<span class='fl'>8</span>]),
         <span class='kw'>b</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>c</span> <span class='kw'>=</span> <span class='no'>mtcars</span>[<span class='fl'>4</span>:<span class='fl'>11</span>], <span class='kw'>d</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>e</span> <span class='kw'>=</span> <span class='no'>mtcars</span>[<span class='fl'>2</span>:<span class='fl'>10</span>], <span class='kw'>f</span> <span class='kw'>=</span> <span class='no'>mtcars</span>)))
<span class='fu'>unlist2d</span>(<span class='no'>l</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'>unlist2d</span>(<span class='fu'><a href='rapply2d.html'>rapply2d</a></span>(<span class='no'>l</span>, <span class='no'>fmean</span>))
<span class='fu'>unlist2d</span>(<span class='fu'><a href='rapply2d.html'>rapply2d</a></span>(<span class='no'>l</span>, <span class='no'>fmean</span>), <span class='kw'>recursive</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'>## Groningen Growth and Development Center 10-Sector Database</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>GGDC10S</span>) <span class='co'># See ?GGDC10S</span>
<span class='fu'><a href='small-helper.html'>namlab</a></span>(<span class='no'>GGDC10S</span>, <span class='kw'>class</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Panel-Summarize this data by Variable (Emloyment and Value Added)</span>
<span class='no'>l</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='qsu.html'>qsu</a></span>(<span class='no'>GGDC10S</span>, <span class='kw'>by</span> <span class='kw'>=</span> ~ <span class='no'>Variable</span>,             <span class='co'># Output as list (instead of 4D array)</span>
         <span class='kw'>pid</span> <span class='kw'>=</span> ~ <span class='no'>Variable</span> + <span class='no'>Country</span>,
         <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>6</span>:<span class='fl'>16</span>, <span class='kw'>array</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>l</span>)                                         <span class='co'># A list of 2-levels with matrices of statistics</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>unlist2d</span>(<span class='no'>l</span>))                              <span class='co'># Default output, missing the variables (row-names)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>unlist2d</span>(<span class='no'>l</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))            <span class='co'># Here we go, but this is still not very nice</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>unlist2d</span>(<span class='no'>l</span>, <span class='kw'>idcols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Sector"</span>,<span class='st'>"Trans"</span>), <span class='co'># Now this is looking pretty good</span>
              <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='st'>"Variable"</span>))

<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>unlist2d</span>(<span class='no'>l</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Sector"</span>,<span class='st'>"Trans"</span>),        <span class='co'># Id-columns can also be generated as ordered factors</span>
                <span class='st'>"Variable"</span>, <span class='kw'>id.factor</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>dat</span>)

<span class='co'># Split this sectoral data, first by Variable (Emloyment and Value Added), then by Country</span>
<span class='no'>sdat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rapply2d.html'>rapply2d</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/split.html'>split</a></span>(<span class='no'>GGDC10S</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>6</span>:<span class='fl'>16</span>)], <span class='no'>GGDC10S</span>$<span class='no'>Variable</span>), <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/split.html'>split</a></span>(<span class='no'>x</span>[-<span class='fl'>1</span>],<span class='no'>x</span><span class='kw'>[[</span><span class='fl'>1</span>]]))

<span class='co'># Compute pairwise correlations between sectors and recombine:</span>
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>unlist2d</span>(<span class='fu'><a href='rapply2d.html'>rapply2d</a></span>(<span class='no'>sdat</span>, <span class='no'>pwcor</span>),
                <span class='kw'>idcols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Variable"</span>,<span class='st'>"Country"</span>),
                <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='st'>"Sector"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>dat</span>)
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/hclust.html'>hclust</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>as.dist</a></span>(<span class='fl'>1</span>-<span class='fu'><a href='pwcor_pwcov_pwNobs.html'>pwcor</a></span>(<span class='no'>dat</span>[-(<span class='fl'>1</span>:<span class='fl'>3</span>)]))))    <span class='co'># Using corrs. as distance metric to cluster sectors</span>

<span class='co'># Together with other functions like psmat, unlist2d can also effectively help reshape data:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>unlist2d</span>(<span class='fu'><a href='psmat.html'>psmat</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span>(<span class='no'>GGDC10S</span>, <span class='no'>Variable</span> <span class='kw'>==</span> <span class='st'>"VA"</span>), ~<span class='no'>Country</span>, ~<span class='no'>Year</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>6</span>:<span class='fl'>16</span>, <span class='kw'>array</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>),
              <span class='kw'>idcols</span> <span class='kw'>=</span> <span class='st'>"Sector"</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='st'>"Country"</span>))</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


